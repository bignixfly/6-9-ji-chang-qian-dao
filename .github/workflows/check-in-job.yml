name: Scheduled Check-In Job

on:
  schedule:
    - cron: '15 2 * * *'  # æ¯å¤© 10:15 åŒ—äº¬æ—¶é—´æ‰§è¡Œï¼ˆUTC+8 å¯¹åº” 02:15 UTCï¼‰
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  checkin:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16'

    - name: Install dependencies
      run: |
        npm install
        npm install node-fetch

    - name: Run scheduled check-in
      run: |
        node _worker.js
      env:
        DOMAIN: ${{ secrets.DOMAIN }}
        USERNAME: ${{ secrets.USERNAME }}
        PASSWORD: ${{ secrets.PASSWORD }}
        TG_TOKEN: ${{ secrets.TG_TOKEN }}
        TG_ID: ${{ secrets.TG_ID }}

    - name: Update README with current time
      run: |
        echo "ğŸ“… **æœ€åè¿è¡Œæ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰**: \`$(date -d '+8 hour' '+%Y-%m-%d %H:%M:%S')\`" > README.md
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git add README.md
        git commit -m "ğŸ•’ æ›´æ–°è¿è¡Œæ—¶é—´: $(date -d '+8 hour' '+%Y-%m-%d %H:%M:%S')" || echo "No changes to commit"
        git push
